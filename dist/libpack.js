!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.libpack=t():e.libpack=t()}(window,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var r=400,n=40,o="./images/tetris-pixel.jpg",a="click",s="keydown",c="keyup",u="mousedown",h="mouseup",l="mouseout",d="Space",p="ArrowLeft",f="ArrowRight",m=".js-cta-start-game",v=".js-cursor-down",_=".js-main-container",y=".js-satellite",g=function(e,t){var i=null;if(!window.requestAnimationFrame)return window.setTimeout(e,t);return window.requestAnimationFrame((function r(n){i||(i=n),n-i<t?window.requestAnimationFrame(r):e()}))},b=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t};function w(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function x(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardConfig_=t,this.canvas_=document.querySelector("canvas"),this.context_=this.canvas_.getContext("2d"),this.matrixSaved_=[],this.rowCompleteIdxs_=new Set,this.linesCompleted_=0,this.boardSpeed_=t.gameSpeed,this.pixelImg_=new Image,this.height=this.boardConfig_.height,this.width=this.boardConfig_.width,this.matrix=[],this.isBoardFilledOnYAxis=!1}var t,i,r;return t=e,(i=[{key:"initMatrix_",value:function(){var e=this.boardConfig_,t=e.width,i=e.height,r=e.pieceSize;this.canvas_.width=t*r,this.canvas_.height=i*r;for(var n=0;n<this.canvas_.width;n++)this.matrix[n]=Array.apply(null,Array(this.canvas_.height)).map(Number.prototype.valueOf,0);this.matrixSaved_=this.matrix.map((function(e){return w(e)}))}},{key:"clearBoard_",value:function(){var e=this.canvas_,t=e.width,i=e.height;this.context_.clearRect(0,0,t,i)}},{key:"saveLineCompleteIdxs_",value:function(e,t){e.reduce((function(e,t){return e+t}),0)===this.width&&this.rowCompleteIdxs_.add(t)}},{key:"getLineCompletedIdxs_",value:function(){for(var e=0;e<this.matrixSaved_.length;e++)for(var t=this.matrixSaved_[e],i=0;i<this.width;i++)t[i]&&this.saveLineCompleteIdxs_(t,e)}},{key:"removeLineFromMatrix_",value:function(){var e=this;this.rowCompleteIdxs_.size&&(this.rowCompleteIdxs_.forEach((function(t,i){for(var r=0;r<e.canvas_.height;r++)e.matrixSaved_[i][r]=0;e.moveDownMatrix_(t)})),this.rowCompleteIdxs_=new Set,this.matrix=this.matrixSaved_.map((function(e){return w(e)})))}},{key:"moveDownMatrix_",value:function(e){for(var t=0;t<this.matrixSaved_.length;t++){var i,r=e-t,n=this.matrixSaved_[r-1],o=null===(i=this.matrixSaved_[r-1])||void 0===i?void 0:i.every((function(e){return 0===e}));n&&(this.matrixSaved_[r]=this.matrixSaved_[r-1]),o&&(this.matrixSaved_[r]=Array.apply(null,Array(this.height)).map(Number.prototype.valueOf,0))}}},{key:"validateMatrixfilledOnYAxis_",value:function(){for(var e=new Map,t=0;t<this.height;t++){var i;e.set(t,null===(i=this.matrixSaved_[t])||void 0===i?void 0:i.every((function(e){return 0===e})))}this.isBoardFilledOnYAxis=w(e.values()).every((function(e){return!1===e}))}},{key:"fillMatrix_",value:function(){if(this.isBoardFilledOnYAxis){for(var e=0;e<this.canvas_.width;e++)this.matrix[e]=Array.apply(null,Array(this.canvas_.height)).map(Number.prototype.valueOf,1);this.matrixSaved_=this.matrix.map((function(e){return w(e)}))}}},{key:"setLinesCompleted_",value:function(){this.linesCompleted_+=this.rowCompleteIdxs_.size}},{key:"getLinesCompleted",value:function(){return this.linesCompleted_}},{key:"setBoardSpeed",value:function(e){this.boardSpeed_=e}},{key:"isMatrixCoordAvailable",value:function(e){var t=this;return e.every((function(e){var i=e[1],r=e[0],n=i>=0&&i<t.width,o=r>=0&&r<t.height;if(n&&o&&!t.matrixSaved_[r][i])return!0}))}},{key:"updateMatrix",value:function(e){for(var t=this,i=function(i){var r=e[i],n=r[0],o=r[1];t.matrix[n][o]=1,g((function(){t.matrix[n][o]=0}),t.boardSpeed_)},r=0;r<e.length;r++)i(r);this.clearBoard_(),this.render()}},{key:"saveMatrix",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1];this.matrix[r][n]=1,this.matrixSaved_[r][n]=1}this.getLineCompletedIdxs_(),this.setLinesCompleted_(),this.removeLineFromMatrix_(),this.validateMatrixfilledOnYAxis_(),this.fillMatrix_(),this.render()}},{key:"resetMatrix",value:function(){this.initMatrix_(),this.render()}},{key:"render",value:function(){for(var e=this.boardConfig_.pieceSize,t=0;t<this.height;t++)for(var i=this.matrix[t],r=0;r<this.width;r++)i[r]&&this.context_.drawImage(this.pixelImg_,r*e,t*e,e,e)}},{key:"init",value:function(){this.pixelImg_.src=o,this.initMatrix_(),this.render()}}])&&x(t.prototype,i),r&&x(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),S={SQUARE:[[[0,0],[0,1],[1,0],[1,1]]],LSHAPE:[[[0,0],[0,1],[0,2],[1,2]],[[0,0],[0,1],[1,0],[2,0]],[[0,0],[1,0],[1,1],[1,2]],[[0,1],[1,1],[2,0],[2,1]]],ZSHAPE:[[[0,0],[0,1],[1,1],[1,2]],[[1,0],[2,0],[1,1],[0,1]]],TSHAPE:[[[0,0],[1,0],[2,0],[1,1]],[[0,1],[1,0],[1,1],[1,2]],[[0,1],[1,1],[1,0],[2,1]],[[1,0],[1,1],[1,2],[2,1]]],JSHAPE:[[[1,0],[1,1],[1,2],[0,2]],[[0,0],[0,1],[1,1],[2,1]],[[0,0],[1,0],[0,1],[0,2]],[[0,0],[1,0],[2,1],[2,0]]],SSHAPE:[[[1,0],[2,0],[1,1],[0,1]],[[0,0],[0,1],[1,1],[1,2]]],ISHAPE:[[[0,0],[0,1],[0,2],[0,3]],[[0,0],[1,0],[2,0],[3,0]]]};function P(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return A(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function M(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardConfig_=t,this.pieceCoord=[],this.pieceWidth=0,this.pieceHeight=0,this.pieceTypeData={type:"",rotationIndex:-1}}var t,i,r;return t=e,(i=[{key:"getPieceHeight_",value:function(e){var t=new Set;return Array.from(e,(function(e){return t.add(e[0])})),t.size}},{key:"getPieceWidth_",value:function(e){var t=new Set;return Array.from(e,(function(e){return t.add(e[1])})),t.size}},{key:"getPieceCurrentPosition_",value:function(){var e=this.getCurrentPieceMaxCoord(),t=this.pieceCoord.reduce((function(e,t){return e.y.push(t[0]),e.x.push(t[1]),e}),{x:[],y:[]}),i=e.xPos,r=e.yPos,n=Math.min.apply(Math,P(t.x)),o=Math.min.apply(Math,P(t.y));return{xPos:Math.round((n+i)/2)-1,yPos:Math.round((o+r)/2)-1}}},{key:"setPieceRotationCoord",value:function(e,t){this.pieceTypeData.rotationIndex=t,this.pieceCoord=e}},{key:"movePieceXPos",value:function(e){var t=0;"right"===e&&(t=1),"left"===e&&(t=-1),this.pieceCoord=this.pieceCoord.map((function(e){return[e[0],e[1]+t]}))}},{key:"movePieceYPos",value:function(){this.pieceCoord=this.pieceCoord.map((function(e){return[e[0]+1,e[1]]}))}},{key:"getNextPieceRotation",value:function(){var e=this.pieceTypeData,t=e.type,i=e.rotationIndex,r=S[t],n=this.getPieceCurrentPosition_(),o=n.xPos,a=n.yPos,s=i+1,c=r[s];return c||(c=r[s=0]),{nextPiecePosition:c.map((function(e){return[e[0]+a,e[1]+o]})),newIndexRotation:s}}},{key:"getCurrentPieceMaxCoord",value:function(){var e=this.pieceCoord.reduce((function(e,t){return e.y.push(t[0]),e.x.push(t[1]),e}),{x:[],y:[]});return{xPos:Math.max.apply(Math,P(e.x)),yPos:Math.max.apply(Math,P(e.y))}}},{key:"getPieceValidXpos_",value:function(){var e=this.boardConfig_.width,t=Array.from(Array(e).keys()),i=t[Math.floor(Math.random()*t.length)];return i+this.pieceWidth>e&&(i-=this.pieceWidth),i}},{key:"getRandomPieceCoord",value:function(){var e,t=Object.keys(S),i=t[Math.floor(Math.random()*t.length)],r=S[i].length,n=Math.floor(Math.random()*r),o=S[i][n];return this.pieceWidth=this.getPieceWidth_(o),this.pieceHeight=this.getPieceHeight_(o),this.pieceTypeData={type:i,rotationIndex:n},e=this.getPieceValidXpos_(),this.pieceCoord=o.map((function(t){return[t[0],t[1]+e]})),this.pieceCoord}},{key:"render",value:function(e,t){return e=e||0,t=t||0,this.pieceCoord=this.pieceCoord.map((function(i){return[i[0]+t,i[1]+e]})),this.getCurrentPieceMaxCoord(),this.pieceCoord}}])&&M(t.prototype,i),r&&M(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function j(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.document_=document,this.board_=t,this.piece_=null,this.mouseDownHoldStarter_=null,this.controlsEventHandler_=this.controlsEventHandler_.bind(this),this.onMouseUp_=this.onMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this)}var t,i,r;return t=e,(i=[{key:"movePieceToRight_",value:function(e){e.code===f&&this.movePieceToRightByCta_(e)}},{key:"isClickBySpaceBar_",value:function(e){return!e.clientX&&"click"===e.type}},{key:"movePieceToRightByCta_",value:function(e){if(!this.isClickBySpaceBar_(e)){var t=this.piece_.pieceCoord,i=e.target,r=39===e.keyCode;if(i.classList.contains(E.RIGHT)||r){var n=t.map((function(e){return[e[0],e[1]+1]}));this.board_.isMatrixCoordAvailable(n)&&this.piece_.movePieceXPos("right")}}}},{key:"movePieceToLeft_",value:function(e){e.code===p&&this.movePieceToLeftByCta_(e)}},{key:"movePieceToLeftByCta_",value:function(e){if(!this.isClickBySpaceBar_(e)){var t=this.piece_.pieceCoord,i=e.target,r=37===e.keyCode;if(i.classList.contains(E.LEFT)||r){var n=t.map((function(e){return[e[0],e[1]-1]}));this.board_.isMatrixCoordAvailable(n)&&this.piece_.movePieceXPos("left")}}}},{key:"rotatePiece_",value:function(e){var t=e.code===p||e.code===f,i=e.code===d;t||i&&this.rotatePieceByCta_(e)}},{key:"rotatePieceByCta_",value:function(e){if(e.target.classList.contains(E.NEXT)||32===e.keyCode){var t=this.piece_.getNextPieceRotation(),i=t.nextPiecePosition,r=t.newIndexRotation;this.board_.isMatrixCoordAvailable(i)&&this.piece_.setPieceRotationCoord(i,r)}}},{key:"onMouseDown_",value:function(e){var t=this;this.mouseDownHoldStarter_=setInterval((function(){t.movePieceToRight_(e),t.movePieceToLeft_(e),t.rotatePiece_(e)}),400)}},{key:"onMouseUp_",value:function(){this.mouseDownHoldStarter_&&clearInterval(this.mouseDownHoldStarter_)}},{key:"controlsEventHandler_",value:function(e){e.target.blur(),this.rotatePiece_(e),this.movePieceToRight_(e),this.movePieceToLeft_(e),e.type===a&&(this.movePieceToRightByCta_(e),this.movePieceToLeftByCta_(e),this.rotatePieceByCta_(e))}},{key:"listenEvents_",value:function(){this.document_.addEventListener(a,this.controlsEventHandler_),this.document_.addEventListener(s,this.controlsEventHandler_),this.document_.addEventListener(u,this.onMouseDown_),this.document_.addEventListener(h,this.onMouseUp_),this.document_.addEventListener(l,this.onMouseUp_),this.document_.querySelector(m).addEventListener(s,(function(e){e.preventDefault(),e.stopPropagation()}))}},{key:"wrapNewPiece",value:function(e){this.piece_=e}},{key:"init",value:function(){this.listenEvents_()}}])&&j(t.prototype,i),r&&j(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),E={LEFT:"js-cursor-left",NEXT:"js-cursor-next",RIGHT:"js-cursor-right"};function I(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scoreSelector_=null,this.linesCompleted_=0}var t,i,r;return t=e,(i=[{key:"linesCompleted",get:function(){return this.linesCompleted_},set:function(e){this.linesCompleted_=e,this.render()}},{key:"render",value:function(){this.scoreSelector_.innerHTML=this.linesCompleted_}},{key:"init",value:function(){this.scoreSelector_=document.querySelector(".js-score")}}])&&I(t.prototype,i),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e){return function(e){if(Array.isArray(e))return H(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return H(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function B(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameConfig_=t,this.document_=document,this.score_=null,this.board_=new C(t),this.piece_=null,this.pieceController_=null,this.isNewPieceNeeded_=!0,this.gameSpeed_=0,this.requestAnimationFrameId_=-1,this.keysPressed={},this.isGameOver=!1,this.pieceMovingXAxisCounter_=0,this.lastKeyUpAt=0,this.isKeyLongPressed=!1,this.getNewPiece_=this.getNewPiece_.bind(this),this.pieceTracker_=this.pieceTracker_.bind(this),this.manageHighSpeed_=this.manageHighSpeed_.bind(this),this.manageDefaultSpeed_=this.manageDefaultSpeed_.bind(this),this.addHighSpeedByClick_=this.addHighSpeedByClick_.bind(this)}var t,i,r;return t=e,(i=[{key:"validatePiecePath_",value:function(){var e=this.piece_.pieceCoord;return this.board_.isMatrixCoordAvailable(e)}},{key:"pieceAdvanceYAxis_",value:function(e){if(this.keysPressed.ArrowDown)return e;if(this.isKeyLongPressed||(this.pieceMovingXAxisCounter_=0),this.pieceMovingXAxisCounter_+=100,this.pieceMovingXAxisCounter_%1200)for(var t=0;t<e.length;t++)e[t][0]=e[t][0]-1;return e}},{key:"pieceTracker_",value:function(){if(this.piece_){var e=this.piece_.pieceCoord,t=this.piece_.render(0,1);if(!this.validatePiecePath_())return this.isNewPieceNeeded_=!0,this.board_.saveMatrix(e),this.getNewPiece_(),void this.setDefaultSpeed_();this.isKeyKeepPressed_()&&(t=this.pieceAdvanceYAxis_(D(t))),this.board_.updateMatrix(t),this.score_.linesCompleted=this.board_.getLinesCompleted(),this.requestAnimationFrameId_=g(this.pieceTracker_,this.gameSpeed_),this.actualTime_=Date.now()}}},{key:"getNewPiece_",value:function(){if(!this.isGameOver)if(this.isNewPieceNeeded_){var e;this.isNewPieceNeeded_=!1,this.piece_=new O(this.gameConfig_),this.pieceController_.wrapNewPiece(this.piece_),e=this.piece_.getRandomPieceCoord(),this.board_.updateMatrix(e),this.isGameOver=this.board_.isBoardFilledOnYAxis,g(this.getNewPiece_,this.gameSpeed_)}else this.pieceTracker_()}},{key:"isKeyKeepPressed_",value:function(){return this.keysPressed.ArrowDown||this.keysPressed.ArrowLeft||this.keysPressed.ArrowRight}},{key:"manageHighSpeed_",value:function(e){var t=this,i=new Date;this.keysPressed[e.code]=!0,setTimeout((function(){+i>+t.lastKeyUpAt?t.isKeyLongPressed=!0:t.isKeyLongPressed=!1}),400),this.isKeyLongPressed&&this.isKeyKeepPressed_()?this.setHightSpeed_():this.setDefaultSpeed_()}},{key:"addHighSpeedByClick_",value:function(e){var t=e.target;(null==t?void 0:t.classList.contains(N.DOWN))&&this.setHightSpeed_()}},{key:"setHightSpeed_",value:function(){this.gameSpeed_=n,this.board_.setBoardSpeed(this.gameSpeed_)}},{key:"setDefaultSpeed_",value:function(){var e=this.gameConfig_.gameSpeed;this.gameSpeed_=e,this.board_.setBoardSpeed(this.gameSpeed_)}},{key:"manageDefaultSpeed_",value:function(e){this.lastKeyUpAt=new Date,"Space"===e.code&&(this.pieceMovingXAxisCounter_=0),delete this.keysPressed[e.key],this.setDefaultSpeed_()}},{key:"listenEvents_",value:function(){var e=b();this.document_.querySelector(v).addEventListener(a,this.addHighSpeedByClick_),e||(this.document_.addEventListener(s,this.manageHighSpeed_),this.document_.addEventListener(c,this.manageDefaultSpeed_),this.document_.addEventListener(u,this.manageHighSpeed_),this.document_.addEventListener(h,this.manageDefaultSpeed_))}},{key:"start",value:function(){this.listenEvents_(),this.getNewPiece_()}},{key:"end",value:function(){this.isGameOver=!0,this.pieceController_=null,this.piece_=null,this.pieceController_=null,this.isNewPieceNeeded_=!1,this.score_.linesCompleted=0,this.board_.resetMatrix(),function(){for(var e=window.requestAnimationFrame((function(){}));e--;)window.cancelAnimationFrame(e)}(this.requestAnimationFrameId_)}},{key:"init",value:function(){var e=this.gameConfig_.gameSpeed;this.gameSpeed_=e,this.score_=new T,this.pieceController_=new L(this.board_),this.board_.init(),this.pieceController_.init(),this.score_.init(),this.start()}}])&&B(t.prototype,i),r&&B(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),N={DOWN:"js-cursor-down"};function R(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function z(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?q(Object(i),!0).forEach((function(t){F(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function F(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"GameFacade",(function(){return X}));var K={width:14,height:22,pieceSize:18,gameSpeed:r};b()&&(K=z(z({},K),{},{width:12,height:21}));var X=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.document_=document,this.body_=document.body,this.startGameCheckbox_=null,this.tetrisContainer_=null,this.game_=null,this.startGameHandler_=this.startGameHandler_.bind(this),this.watchGameStatus_=this.watchGameStatus_.bind(this)}var t,i,r;return t=e,(i=[{key:"startGameHandler_",value:function(e){var t,i=e.target.checked;b()?null===(t=this.document_.querySelector(y))||void 0===t||t.scrollIntoView():this.body_.scrollIntoView(),i?this.startGame_():this.endGame_()}},{key:"startGame_",value:function(){this.game_=new G(K),this.game_.init(),this.body_.classList.add(U.SCROLL_DISABLED),this.tetrisContainer_.classList.remove(U.GAME_ACTIVE),this.watchGameStatus_()}},{key:"endGame_",value:function(){this.game_.end(),this.body_.classList.remove(U.SCROLL_DISABLED),this.tetrisContainer_.classList.add(U.GAME_ACTIVE)}},{key:"listenEvents_",value:function(){this.startGameCheckbox_.addEventListener(a,this.startGameHandler_)}},{key:"watchGameStatus_",value:function(){this.game_.isGameOver&&(this.endGame_(),this.startGameCheckbox_.checked=!1),g(this.watchGameStatus_,this.gameSpeed_)}},{key:"init",value:function(){this.tetrisContainer_=this.document_.querySelector(_),this.startGameCheckbox_=this.document_.querySelector(m),this.startGameCheckbox_&&this.listenEvents_()}}])&&R(t.prototype,i),r&&R(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();(new X).init();var U={SCROLL_DISABLED:"scroll-disabled",GAME_ACTIVE:"tetris-main-container-start"}}])}));